## Запуск кода


#### Описание конфиг-файла
[bot]  
token - токен бота, необходимо получить у https://t.me/BotFather  
db_path - путь до базы данных (по умолчанию data/database.db) 
создаётся автоматически при запуске проекта. 
lenght - длина номера заявки (по умолчанию 6)  
adminId - chat_id пользователей в телеграм. Можно прописать несколько, через запятую. Устанавливает пользователей с доступом к админ-панели. 
channelId - id канала, куда будут отправляться новые заявки. Бот должен быть администратором этого канала. 

[yandex]  
token - обязательный OAuth токен для интеграции с Яндекс.Диском. Можно получить по инструкции https://yandex.ru/dev/disk-api/doc/ru/concepts/quickstart#quickstart__oauth  
excel_path - путь хранения файла excel на устройстве (по умолчанию media/claims.xlsx) 
Можно переименовать claims.xlsx, в этом случае название сменится и в Яндекс.Диске. 
dir_path - наименование папки на Яндекс.Диске. Если папки не существует - она создастся автоматически. В неё будут выгружаться: excel и все медиафайлы заявок.  

[mail]  
enable - флаг включения отправки на почту. (по умолчанию 0).  
Если флаг включен (равен 1) - следующие параметры обязательны:  
server - smtp сервер (например smtp.mail.ru)  
user - имя пользователя, от лица которого будет отправка.  
password - пароль для smtp протокола  

**При внесении изменений в конфиг-файл, чтобы изменения вступили в силу требуется презапуск бота**  

### Запуск на локальной машине  
На устройстве должен быть установлена версия Python не ниже 3.10.  

Выгрузите проект на устройство любым удобным способом.  
Необходимо зайти в командную строку и перейти в папку с проектом.  
Вводим следующие команды:  

> python3 -m venv env  

Для Windows  
> source env\Scripts\activate  
Для Unix  
> . ./env/bin/activate  

Устанавливаем зависимости  
> pip install -r requirements.txt  

На этом шаге убедитесь, что конфиг-файл настроен, после этого введите:  
> python main.py  

Бот запущен и работает на локальной машине.  

##### Перезапуск бота на локальной машине  
Нажмите сочетание клавиш Ctrl +  C находясь в командной строке, и заново введите  
> python main.py  

### Запуск на сервере

Убедитесь, что сервер использует ОС Ubuntu 20.04 или 22.04

Зайдите на сервер по SSH доступу. И выполните следующие команды:

> apt install -y git python3.10 python3-venv

> git clone https://github.com/IvVlasov/forestBot

> cd forestBot

Далее необходимо настроить конфигурацию в файле config/config.ini
Сделать это можно с помощью консольного редактора (nano/vim), либо же через доступ по FTP

После полной настройки конфигурации, вернитесь в папку проекта и введите

> . ./deployment/run.sh

Готово, бот развёрнут и запущен на сервере.

##### Перезапуск бота на сервере
Находясь на сервере (по ssh) введите:
>systemctl restart bot.service


#### Административная панель

Для входа в админ-панель бота введите /admin
бот предложит несколько кнопок
1. Выгрузить Excel - выгрузка актуального excel файла с заявками
2. Изменить нарушения - функционал для изменения пользовательских кнопок бота на шаге ввода нарушения
3. Найти заявку - все заявки хранятся в базе (даже если excel очищался), если возникла проблема с поиском нужной, можно её, прислав номер заявки
4. Отправить сообщение - можно отправить сообщение любому пользователю от лица бота
5. Очистить Excel - полностью удаляет данные из excel, в том числе и на Яндекс.Диске
